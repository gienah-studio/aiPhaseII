# 学员收入统计页面测试指南

## 功能概述
新增了学员收入统计页面，用于管理员查看所有学员前一天的收入统计数据。

## 页面位置
- 路由：`/student-income`
- 菜单：侧边栏 -> 收入统计
- 权限：管理员可访问

## 功能特性

### 1. 汇总统计
- **学员总数**：参与统计的学员总数
- **总佣金**：所有学员的佣金总和
- **总订单数**：所有学员完成的订单总数
- **总实际收入**：所有学员的实际到手金额总和

### 2. 学员明细列表
- **学员信息**：姓名、手机号、学员ID
- **昨日佣金**：该学员前一天的佣金总额
- **完成订单**：该学员前一天完成的订单数
- **返佣比例**：该学员的代理返佣比例
- **实际到手**：该学员的实际到手金额
- **代理ID**：该学员所属的代理ID

### 3. 页面功能
- **自动加载**：页面加载时自动获取数据
- **手动刷新**：点击"刷新数据"按钮重新获取
- **错误处理**：网络错误时显示错误信息和重试按钮
- **加载状态**：数据加载时显示加载动画
- **表格排序**：支持按佣金、订单数、实际收入排序
- **分页显示**：支持分页浏览学员数据

### 4. 响应式设计
- 支持桌面端和移动端
- 自适应布局
- 表格支持横向滚动

## 测试步骤

### 1. 启动服务
```bash
# 启动后端服务
cd RD
python -m services.auth_service.main

# 启动前端服务
cd FE/aiPhaseII
npm run dev
```

### 2. 访问页面
1. 登录系统
2. 在侧边栏点击"收入统计"
3. 查看页面是否正常显示

### 3. 功能测试
1. **数据加载测试**
   - 页面应自动加载数据
   - 检查是否显示加载动画

2. **数据显示测试**
   - 检查四个统计卡片是否正常显示
   - 检查数据格式是否正确（金额保留2位小数）

3. **刷新功能测试**
   - 点击"刷新数据"按钮
   - 检查是否重新加载数据

4. **错误处理测试**
   - 关闭后端服务
   - 刷新页面，检查是否显示错误信息
   - 点击"重试"按钮测试

5. **响应式测试**
   - 调整浏览器窗口大小
   - 检查布局是否自适应

## API接口
- **接口地址**：`GET /auth/student/daily-income-stats`
- **认证方式**：Bearer Token
- **返回数据**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "students": [
      {
        "student_id": 123,
        "student_name": "测试学员",
        "yesterday_income": "100.00",
        "yesterday_completed_orders": 3,
        "commission_rate": "0.75",
        "actual_income": "75.00",
        "phone_number": "13800138000",
        "agent_id": 456
      }
    ],
    "total": 1,
    "stat_date": "2024-01-15"
  }
}
```

## 注意事项

### 1. 权限要求
- 只有学员角色可以访问此页面
- 需要有效的登录token

### 2. 数据要求
- 需要在数据库中有相关的任务数据
- 需要有代理信息配置返佣比例

### 3. 时间逻辑
- 统计的是前一天（昨天）的数据
- 时间范围：昨天 00:00:00 - 23:59:59

## 故障排除

### 1. 页面无法访问
- 检查路由配置是否正确
- 检查用户是否已登录

### 2. 数据加载失败
- 检查后端服务是否启动
- 检查API接口是否正常
- 检查用户token是否有效

### 3. 数据显示异常
- 检查数据库中是否有测试数据
- 检查代理返佣比例配置
- 检查任务状态是否正确

### 4. 样式问题
- 检查CSS文件是否正确加载
- 检查Antd组件是否正常

## 开发说明

### 文件结构
```
FE/aiPhaseII/src/pages/dashboard/StudentIncome/
├── index.tsx           # 主组件
└── index.module.css    # 样式文件
```

### 相关文件修改
- `src/constants/routes.ts` - 添加路由常量
- `src/pages/dashboard/index.ts` - 导出新页面
- `src/App.tsx` - 添加路由配置
- `src/components/Layout/MainLayout.tsx` - 添加菜单项
- `src/api/auth/types.ts` - 添加类型定义
- `src/api/auth/login.ts` - 添加API调用

### 技术栈
- React + TypeScript
- Ant Design
- React Router
- CSS Modules
